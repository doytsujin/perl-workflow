<!--
 This is a single workflow type which can be instantiated separately
 from the others; all workflows have access to the same universe of
 validators and conditions (described below)
-->

<workflow>
 <type>Ticket</type>
 <description>This is the workflow for sample application Ticket</description>

<!-- 
 data from these tables are pulled at workflow instantiation time and
 put into parameters and/or context so they're available from all
 actions, conditions, and validators
-->

  <extra_data
    table="workflow_ticket"
    field="ticket_id"
    class="Ticket"
    context="ticket"/>

  <state name="INITIAL">
     <description>This is the state the workflow enters when instantiated. It's
like a 'state zero' but since we're using names rather than IDs we cannot assume</description>

<!-- This action is accessible from this state by everyone -->
     <action name="TIX_NEW"
        resulting_state="TIX_CREATED"/>
  </state>

  <state name="TIX_CREATED">
     <description>State of ticket after it has been created</description>
<!--
#[TIX_CREATED TIX_COMMENT]
#resulting_state = NOCHANGE
-->

<!--
# This action is accessible from this state by environments meeting
# the 'IsAdminUser' condition
#[TIX_CREATED TIX_CLOSE]
#condition = IsAdminUser
#condition_denied_message = Only administrators can close tickets.
#resulting_state = TIX_CLOSED
-->

     <action name="TIX_EDIT"
             resulting_state="TIX_IN_PROGRESS">
        <condition name="IsWorker"/>
     </action>
   </state>

   <state name="TIX_IN_PROGRESS">
      <description>State of ticket after developers start work</description>
      <action name="TIX_CLOSE"
              resulting_state="TIX_CLOSED">
         <condition name="IsCreator"/>
      </action>
   </state>

<!--
#[TIX_AWAITS_APPROVAL]
#description = State of ticket after developers complete work

#[TIX_AWAITS_APPROVAL TIX_CLOSE]
#condition = IsCreationUser
#resulting_state = TIX_CLOSED
#condition_denied_message = Only ticket creators can close tickets.

#[TIX_AWAITS_APPROVAL TIX_ESCALATE]
#condition = IsCreationUser
#resulting_state = TIX_CREATED_ESCALATED
#condition_denied_message = Only ticket creators can escalate tickets.
-->

   <state name="TIX_CLOSED">
      <description>State of ticket after creator approves the work done</description>
      <action name="TIX_REOPEN"
              resulting_state="TIX_CREATED">
         <condition name="IsCreator"/>
      </action>
   </state>
</workflow>